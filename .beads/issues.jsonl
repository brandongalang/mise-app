{"id":"meal-1","title":"Project Setup: Next.js + Dependencies","description":"Initialize Next.js 14 app with: @ax-llm/ax (agent framework), @ai-sdk/google + ai (Vercel AI SDK for chat UI), shadcn/ui (components), better-sqlite3 + drizzle-orm (database), tailwindcss. Configure TypeScript strict mode. Set up project structure: src/app (Next.js pages), src/lib (utilities), src/db (database), src/agent (Ax agent + tools), src/components (UI). Create .env.example with GOOGLE_API_KEY placeholder.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-28T17:09:45.301889-05:00","updated_at":"2025-12-04T20:42:48.750058-05:00","closed_at":"2025-11-28T17:20:53.519968-05:00"}
{"id":"meal-10","title":"Dashboard UI Component","description":"Build dashboard as home screen using ShadCN components. Sections: 1) Header with app name + chat shortcut, 2) Expiring Soon section (red/yellow items, tap‚Üíopens chat with context), 3) Inventory summary by category (collapsible, shows count per category), 4) Leftovers section (dish names with remaining servings/expiry), 5) Quick action buttons: [üì∑ Add Items]‚Üícamera‚Üíchat, [üç≥ What Can I Make?]‚Üíchat with prompt. Dashboard is read-only, all taps route to chat with pre-filled context. Fetches from GET /api/v1/inventory/summary. Mobile-first layout, side-by-side with chat on desktop.","design":"Dashboard as secondary view, accessed via slide-up panel from chat.\n\n## Approach: Hybrid shadcn + Custom\n- Use shadcn Drawer (Vaul) for bottom sheet - handles gestures, snap points, accessibility\n- Custom components for content inside\n\n## Design System (\"Vibrant Organic\")\nSame as meal-9: Fraunces/DM Sans fonts, cream/herb/tomato/citrus palette\n\n## Components to Create\n\n### InventorySheet (src/components/inventory/InventorySheet.tsx)\n- Uses shadcn Drawer (Vaul) primitive\n- Slide up from bottom, drag handle at top\n- Initial height: 50vh, expandable to 90vh\n- Swipe down to dismiss\n\n### CategoryTabs (src/components/inventory/CategoryTabs.tsx)\n- Horizontal scrolling tabs: Produce, Protein, Dairy, Pantry, Frozen, Beverage\n- Filter items by category\n- Can use shadcn Tabs or custom\n\n### InventoryItem (src/components/inventory/InventoryItem.tsx)\n- Layout: [icon] [name] [expiry days]\n-         [quantity + unit] [status badge]\n- Expiry color coding:\n  - \u003c=2 days: text-tomato + red dot\n  - \u003c=5 days: text-citrus + orange dot\n  - \u003e5 days: text-herb + green dot\n- Status badges: SEALED (green), OPEN (yellow), LOW (red)\n\n### ExpiringBanner (src/components/alerts/ExpiringBanner.tsx)\n- Shows at top of chat when items expiring\n- Layout: [warning icon] \"3 items expiring soon\" [dismiss X]\n-         \"Milk expires tomorrow\"\n- Styling: bg-citrus/10 border-l-4 border-citrus\n- Tap opens inventory sheet filtered to expiring\n\n## Hook: useInventory (src/hooks/useInventory.ts)\nFetches GET /api/v1/inventory/summary\nReturns: summary, isLoading, error, refetch()\n\n## Install shadcn Drawer\nnpx shadcn@latest add drawer","acceptance_criteria":"- [ ] InventorySheet opens as slide-up panel (shadcn Drawer)\n- [ ] Drag handle visible, swipe down to dismiss\n- [ ] CategoryTabs filter items by category\n- [ ] InventoryItem shows name, quantity, expiry with color coding\n- [ ] Expiry colors: red (\u003c=2d), orange (\u003c=5d), green (\u003e5d)\n- [ ] ExpiringBanner shows at top of chat when items expiring\n- [ ] Banner tap opens InventorySheet\n- [ ] Data fetched via useInventory hook\n- [ ] Sheet accessible via \"Inventory\" quick action chip","notes":"SUPERSEDES ORIGINAL DESCRIPTION - Use Design notes instead.\n\nOriginal description said dashboard is \"home screen\" - this has been updated.\nCorrect approach: Dashboard is a slide-up panel accessed FROM chat (chat-first).\nSee Design field for full implementation spec.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-28T17:11:00.045586-05:00","updated_at":"2025-12-04T20:42:48.751173-05:00","closed_at":"2025-11-28T18:07:49.018361-05:00","dependencies":[{"issue_id":"meal-10","depends_on_id":"meal-8","type":"blocks","created_at":"2025-11-28T17:11:13.543083-05:00","created_by":"brandongalang"},{"issue_id":"meal-10","depends_on_id":"meal-9","type":"blocks","created_at":"2025-11-28T17:53:28.411138-05:00","created_by":"brandongalang"},{"issue_id":"meal-10","depends_on_id":"meal-15","type":"blocks","created_at":"2025-11-28T17:53:28.417885-05:00","created_by":"brandongalang"}]}
{"id":"meal-11","title":"Image Upload Handling","description":"Implement client-side image handling for chat. Flow: 1) User taps camera button, 2) Native file picker opens (accept image/*), 3) Client-side resize to max 2048px longest edge (quality 0.8) using canvas, 4) Convert to base64, 5) Show thumbnail preview in chat input area, 6) On send: include as attachment in chat request, 7) Show thumbnail in user message bubble. Handle: large files (compress), wrong file types (reject with message), upload failures (retry prompt). No separate upload endpoint‚Äîimage goes directly in chat request body.","design":"Client-side image handling integrated into ChatInput component.\n\n## Flow\n1. User taps camera button in ChatInput\n2. Native file picker opens (accept=\"image/*\", capture=\"environment\")\n3. On select: resize to max 2048px longest edge, quality 0.8 via canvas\n4. Convert to base64\n5. Show thumbnail preview (48x48) above input with X to remove\n6. On send: include as attachment in chat request body\n7. Show thumbnail in user MessageBubble\n\n## Implementation Details\n\n### In ChatInput.tsx\n- Hidden input[type=file] with ref\n- Camera button triggers inputRef.click()\n- onChange: process image through resizeImage()\n- Preview state: pendingImage: { data: string, mimeType: string } | null\n\n### resizeImage utility (src/lib/image-utils.ts)\n```typescript\nasync function resizeImage(file: File, maxSize: number): Promise\u003cstring\u003e {\n  // Create canvas, draw image scaled down, toDataURL\n}\n```\n\n### Error Handling\n- Wrong file type: Show toast \"Please select an image\"\n- File too large (\u003e10MB before resize): Show warning\n- Resize failure: Fall back to original if under 5MB\n\n### Mobile Considerations\n- Use capture=\"environment\" for rear camera default\n- Handle HEIC from iOS (should auto-convert)\n- Test on iOS Safari and Android Chrome\n\n## No Separate Upload Endpoint\nImage goes directly in POST /api/v1/chat request body as base64.\nAlready supported by existing API.","acceptance_criteria":"- [ ] Camera button in ChatInput opens file picker\n- [ ] accept=\"image/*\" and capture=\"environment\" attributes set\n- [ ] Selected image resized to max 2048px via canvas\n- [ ] Thumbnail preview (48x48) shown above input before send\n- [ ] X button removes pending image\n- [ ] Image included as base64 attachment in sendMessage()\n- [ ] Thumbnail shown in user MessageBubble after send\n- [ ] Error handling for wrong file type\n- [ ] Works on iOS Safari and Android Chrome\n- [ ] src/lib/image-utils.ts contains resizeImage function","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-28T17:11:07.793023-05:00","updated_at":"2025-12-04T20:42:48.751397-05:00","closed_at":"2025-11-28T18:06:40.985775-05:00","dependencies":[{"issue_id":"meal-11","depends_on_id":"meal-9","type":"blocks","created_at":"2025-11-28T17:11:13.550509-05:00","created_by":"brandongalang"}]}
{"id":"meal-12","title":"Design System Setup","description":"Set up the Vibrant Organic design system foundation.\n\n## Dependencies to Install\nnpm install framer-motion @fontsource/fraunces @fontsource/dm-sans\n\n## Optional: shadcn for Drawer\nnpx shadcn@latest init (if not already)\nnpx shadcn@latest add drawer\n\n## Files to Modify\n\n### src/app/layout.tsx\nAdd font imports:\nimport '@fontsource/fraunces/400.css';\nimport '@fontsource/fraunces/600.css';\nimport '@fontsource/fraunces/700.css';\nimport '@fontsource/dm-sans/400.css';\nimport '@fontsource/dm-sans/500.css';\nimport '@fontsource/dm-sans/600.css';\n\n### src/app/globals.css\nAdd CSS variables - see FRONTEND.md for complete list:\n- Colors: cream, clay, tomato, herb, citrus, eggplant, charcoal\n- Typography: font-display, font-body, text scale\n- Spacing: space-1 through space-10\n- Shadows: sm, md, lg\n- Radius: sm, md, lg, full\n- Semantic: expiry-urgent, expiry-soon, expiry-ok\n\n## Acceptance Criteria\n- [ ] Fonts load correctly (check Network tab)\n- [ ] CSS variables accessible in components\n- [ ] Body has cream background, charcoal text\n- [ ] Headers use Fraunces font","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-28T17:52:46.053282-05:00","updated_at":"2025-12-04T20:42:48.751585-05:00","closed_at":"2025-11-28T18:04:42.503564-05:00"}
{"id":"meal-13","title":"Recipe Preview Card","description":"Expandable recipe card shown inline in chat when assistant suggests a recipe.\n\n## File: src/components/chat/RecipePreviewCard.tsx\n\n## Props Interface\ninterface RecipePreviewCardProps {\n  recipe: {\n    title: string;\n    timeEstimateMins: number;\n    usesExpiring: string[];\n    ingredients: Array\u003c{ name: string; inStock: boolean }\u003e;\n    steps: string[];\n  };\n  onExpand: () =\u003e void;\n  expanded?: boolean;\n}\n\n## Collapsed State (default)\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ üç≥ Spinach Frittata         ‚îÇ\n‚îÇ 25 min ‚Ä¢ Uses: spinach,     ‚îÇ\n‚îÇ eggs, cheese                ‚îÇ\n‚îÇ [View Full Recipe ‚Üí]        ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n## Expanded State\n- Full ingredient list with checkmarks for in-stock items\n- Numbered steps\n- \"I cooked this!\" button to trigger ingredient deduction\n\n## Styling\n- Card: bg-white rounded-lg shadow-md p-4\n- Title: font-display (Fraunces) text-lg\n- Time badge: bg-citrus/20 text-citrus rounded-full px-2\n- Expand uses Framer Motion for smooth height animation\n\n## Behavior\n- Tap card or \"View Full Recipe\" to expand\n- Expanded state can be inline or open in a Drawer (user preference TBD)\n- \"I cooked this!\" sends chat message to deduct ingredients","acceptance_criteria":"- [ ] RecipePreviewCard component created\n- [ ] Collapsed state shows title, time, key ingredients\n- [ ] \"View Full Recipe\" button/link visible\n- [ ] Expanded state shows full ingredient list with in-stock checkmarks\n- [ ] Expanded state shows numbered steps\n- [ ] \"I cooked this!\" button visible in expanded state\n- [ ] Framer Motion animation for expand/collapse\n- [ ] Styling matches design system (Fraunces title, citrus badge)\n- [ ] Card renders inline within assistant MessageBubble","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-28T17:52:58.758774-05:00","updated_at":"2025-12-04T20:42:48.751946-05:00","closed_at":"2025-11-28T18:06:40.984697-05:00","dependencies":[{"issue_id":"meal-13","depends_on_id":"meal-9","type":"blocks","created_at":"2025-11-28T17:53:28.427129-05:00","created_by":"brandongalang"}]}
{"id":"meal-14","title":"useChat Hook","description":"React hook for managing chat state and SSE communication.\n\n## File: src/hooks/useChat.ts\n\n## Interface\ninterface Message {\n  id: string;\n  role: 'user' | 'assistant';\n  content: string;\n  timestamp: Date;\n  attachments?: Array\u003c{\n    type: 'image';\n    data: string;\n    mimeType: string;\n  }\u003e;\n  actionCard?: RecipeCard | ConfirmationCard;\n}\n\ninterface UseChatReturn {\n  messages: Message[];\n  isThinking: boolean;\n  thinkingText: string;\n  sendMessage: (text: string, attachments?: Attachment[]) =\u003e Promise\u003cvoid\u003e;\n  clearHistory: () =\u003e void;\n}\n\n## SSE Implementation\nUse fetch with ReadableStream (NOT EventSource - need POST):\n\nconst response = await fetch('/api/v1/chat', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({ message, attachments, conversationHistory })\n});\n\nconst reader = response.body.getReader();\nconst decoder = new TextDecoder();\n\n// Parse SSE format: \"event: {type}\\ndata: {json}\\n\\n\"\n\n## Event Handling\n- 'thinking': Set isThinking=true, thinkingText from data\n- 'message': Append assistant message to messages[]\n- 'actions': Store action metadata (for recipe cards, confirmations)\n- 'complete': Set isThinking=false\n- 'error': Set isThinking=false, show error toast\n\n## State Persistence (optional)\n- Store conversationHistory in localStorage\n- Limit to last 20 messages to manage size\n- Clear on clearHistory()","acceptance_criteria":"- [ ] Hook exports useChat() function\n- [ ] sendMessage() posts to /api/v1/chat and streams response\n- [ ] SSE events (thinking, message, actions, complete, error) update state correctly\n- [ ] isThinking=true during request, false after complete/error\n- [ ] messages[] accumulates conversation history\n- [ ] Attachments (base64 images) included in request when provided\n- [ ] conversationHistory passed to API for context\n- [ ] clearHistory() resets messages to empty array","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-28T17:53:10.970444-05:00","updated_at":"2025-12-04T20:42:48.752131-05:00","closed_at":"2025-11-28T18:04:42.50577-05:00"}
{"id":"meal-15","title":"useInventory Hook","description":"React hook for fetching inventory summary data.\n\n## File: src/hooks/useInventory.ts\n\n## Interface\ninterface UseInventoryReturn {\n  summary: InventorySummary | null;\n  isLoading: boolean;\n  error: Error | null;\n  refetch: () =\u003e void;\n}\n\ninterface InventorySummary {\n  expiringSoon: InventoryItem[];\n  categories: Record\u003cIngredientCategory, { count: number; items: InventoryItem[] }\u003e;\n  leftovers: InventoryItem[];\n  totalCount: number;\n}\n\n## Implementation\n- Fetch from GET /api/v1/inventory/summary\n- Use React useState + useEffect (or useSWR if preferred)\n- refetch() for manual refresh after chat actions\n\n## Usage\nconst { summary, isLoading, refetch } = useInventory();\n\n// In ExpiringBanner\n{summary?.expiringSoon.length \u003e 0 \u0026\u0026 \u003cExpiringBanner items={summary.expiringSoon} /\u003e}\n\n// In InventorySheet\n{summary?.categories.produce.items.map(item =\u003e \u003cInventoryItem key={item.containerId} item={item} /\u003e)}\n\n## Types\nImport InventoryItem and IngredientCategory from src/lib/types.ts (already exists)","acceptance_criteria":"- [ ] Hook exports useInventory() function\n- [ ] Fetches from GET /api/v1/inventory/summary on mount\n- [ ] Returns summary with expiringSoon, categories, leftovers, totalCount\n- [ ] isLoading=true during fetch, false after\n- [ ] error populated on fetch failure\n- [ ] refetch() triggers new fetch and updates state\n- [ ] Types imported from src/lib/types.ts","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-28T17:53:21.234505-05:00","updated_at":"2025-12-04T20:42:48.752527-05:00","closed_at":"2025-11-28T18:04:42.505918-05:00"}
{"id":"meal-16","title":"Phase 3: Dashboard First UI","description":"","status":"open","priority":2,"issue_type":"epic","created_at":"2025-11-28T18:21:49.965251-05:00","updated_at":"2025-12-04T20:42:48.752865-05:00","dependencies":[{"issue_id":"meal-16","depends_on_id":"meal-17","type":"blocks","created_at":"2025-11-28T18:21:57.03032-05:00","created_by":"brandongalang"},{"issue_id":"meal-16","depends_on_id":"meal-18","type":"blocks","created_at":"2025-11-28T18:21:57.391573-05:00","created_by":"brandongalang"},{"issue_id":"meal-16","depends_on_id":"meal-19","type":"blocks","created_at":"2025-11-28T18:21:57.929461-05:00","created_by":"brandongalang"}]}
{"id":"meal-17","title":"Navigation Components","description":"","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-28T18:21:50.664055-05:00","updated_at":"2025-12-04T20:42:48.753039-05:00","closed_at":"2025-11-28T18:22:29.741243-05:00"}
{"id":"meal-18","title":"Dashboard UI Components","description":"","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-28T18:21:50.931987-05:00","updated_at":"2025-12-04T20:42:48.753217-05:00","closed_at":"2025-11-28T18:23:11.653013-05:00"}
{"id":"meal-19","title":"Integrate Navigation and Dashboard","description":"","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-28T18:21:51.519942-05:00","updated_at":"2025-12-04T20:42:48.753376-05:00","closed_at":"2025-11-28T18:23:31.781783-05:00","dependencies":[{"issue_id":"meal-19","depends_on_id":"meal-17","type":"blocks","created_at":"2025-11-28T18:21:58.275016-05:00","created_by":"brandongalang"},{"issue_id":"meal-19","depends_on_id":"meal-18","type":"blocks","created_at":"2025-11-28T18:21:58.692444-05:00","created_by":"brandongalang"}]}
{"id":"meal-2","title":"Database Schema + Drizzle ORM","description":"Implement SQLite schema using Drizzle ORM. Tables: master_ingredients (id, canonical_name, category, default_unit, default_shelf_life_days), ingredient_aliases (alias, master_id, source), global_unit_conversions (from_unit, to_unit, factor), containers (id, master_id, dish_name, cooked_from_recipe_id, status, purchase_unit, source, confidence, vision_job_id, expires_at, timestamps), contents (id, container_id, remaining_qty, unit), transactions (id, container_id, operation, delta, unit, reason), cooked_recipes (id, title, ingredients_used JSON, leftovers_created_id). Seed global_unit_conversions with lb/oz/kg‚Üíg, l/cup/tbsp/tsp/fl_oz‚Üíml, dozen‚Üícount. Create db client singleton.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-28T17:09:54.271598-05:00","updated_at":"2025-12-04T20:42:48.75353-05:00","closed_at":"2025-11-28T17:20:53.526361-05:00","dependencies":[{"issue_id":"meal-2","depends_on_id":"meal-1","type":"blocks","created_at":"2025-11-28T17:11:13.473582-05:00","created_by":"brandongalang"}]}
{"id":"meal-20","title":"Add Error Boundary Component","description":"","design":"Create src/components/ErrorBoundary.tsx using React.Component with componentDidCatch. Fallback UI should match app design (ivory bg, terracotta accent). Include: error icon, friendly message, reload button, option to clear app state. Wrap app in layout.tsx around SessionProvider.","acceptance_criteria":"1. App doesn't crash on component errors. 2. Fallback UI shows on error. 3. Console logs error details. 4. Reload button works. 5. Error boundary tested with intentional error.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T00:56:52.083762-05:00","updated_at":"2025-12-04T20:42:48.753683-05:00"}
{"id":"meal-21","title":"Memoize Performance-Critical Components","description":"","design":"Add React.memo to: MessageBubble, InventoryItem, InventoryReviewCard, LeftoverCard, QuickActionChips. Move QuickActionChips actions array to constant (src/lib/constants.ts). Use custom comparison function for MessageBubble (check message.id, content, toolCalls). Profile with React DevTools before/after.","acceptance_criteria":"1. Components wrapped in React.memo. 2. No unnecessary re-renders on parent updates. 3. Actions array is constant. 4. Props properly compared. 5. Performance measured and improved.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T00:56:54.733319-05:00","updated_at":"2025-12-04T20:42:48.753938-05:00"}
{"id":"meal-22","title":"Add Skeleton Loading States","description":"","design":"Create src/components/ui/Skeleton.tsx with variants: text, circle, rectangle. Add SkeletonList for dashboard inventory, SkeletonMessage for chat, SkeletonCard for eat-first section. Use CSS animation for shimmer effect. Replace spinner in DashboardView and ChatContainer loading states. Match component dimensions.","acceptance_criteria":"1. Skeleton component created with variants. 2. Dashboard shows skeleton list while loading. 3. Chat shows skeleton messages. 4. Skeletons match final UI layout. 5. Smooth transition to real content.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T00:56:56.876833-05:00","updated_at":"2025-12-04T20:42:48.754373-05:00"}
{"id":"meal-23","title":"Implement Optimistic Updates for Inventory","description":"","design":"Update useInventory to support optimistic updates. When saving items in InventoryReviewSheet, immediately add to local state, show success toast, then persist to DB. On error, rollback and show error toast. Use optimistic update pattern: 1) Update UI, 2) Call API, 3) Rollback on error. Consider using React Query or custom hook pattern.","acceptance_criteria":"1. UI updates immediately on save. 2. Toast shows success instantly. 3. Rollback on API failure. 4. Error toast on failure. 5. Final state matches DB. 6. No flicker or double-render.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T00:56:59.009084-05:00","updated_at":"2025-12-04T20:42:48.754642-05:00"}
{"id":"meal-24","title":"Add Retry Logic to Network Requests","description":"","design":"Create src/lib/retry.ts with exponential backoff helper. Wrap fetch calls in useChat (sendMessage) and useInventory (fetchInventory) with retry logic. Max 3 retries, exponential backoff (1s, 2s, 4s). Show retry attempt in error message. Don't retry on 4xx errors (only 5xx and network errors). Update error states to show 'Retrying (2/3)...'.","acceptance_criteria":"1. Retry helper created. 2. useChat retries on network failure. 3. useInventory retries on network failure. 4. Max 3 retries with backoff. 5. Error shows retry count. 6. No retry on 4xx errors.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T00:57:00.828327-05:00","updated_at":"2025-12-04T20:42:48.75482-05:00"}
{"id":"meal-25","title":"Improve Accessibility (ARIA \u0026 Focus Management)","description":"","design":"Add ARIA labels: ChatInput (aria-label='Message input'), camera button (aria-label='Attach image'), QuickActionChips buttons, InventoryItem buttons. Implement focus trap in InventoryReviewSheet using focus-trap-react. Add keyboard shortcuts: Cmd+K to focus chat, Esc to close modals, Enter to send. Add role='status' to ThinkingIndicator for screen reader announcements.","acceptance_criteria":"1. All interactive elements have ARIA labels. 2. Focus trapped in open modals. 3. Keyboard shortcuts work. 4. Screen reader announces loading states. 5. Tab navigation works correctly. 6. Tested with VoiceOver/NVDA.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T00:57:02.940657-05:00","updated_at":"2025-12-04T20:42:48.754982-05:00"}
{"id":"meal-26","title":"Setup Testing Infrastructure","description":"","design":"Setup: Install vitest, @testing-library/react, @testing-library/jest-dom, happy-dom, @playwright/test. Create vitest.config.ts. Add test scripts to package.json. Example tests: useChat hook (message sending, SSE parsing), ChatContainer (rendering, user interaction), InventoryItem component. Create tests/setup.ts. Add Playwright config for e2e (chat flow, inventory save).","acceptance_criteria":"1. Vitest configured and running. 2. Example unit tests pass. 3. RTL component tests pass. 4. Playwright installed. 5. At least one e2e test. 6. npm test works.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T00:57:05.112012-05:00","updated_at":"2025-12-04T20:42:48.755136-05:00"}
{"id":"meal-27","title":"Centralize API Client Layer","description":"","design":"Create src/lib/api-client.ts with typed methods: chat.send(), inventory.getSummary(), inventory.save(). Use fetch wrapper with: base URL, error handling, type inference, request/response interceptors. Move all fetch calls from useChat, useInventory, ChatContainer to use client. Export typed client instance. Consider using ky or custom fetch wrapper.","acceptance_criteria":"1. API client created with typed methods. 2. All fetch calls migrated. 3. Error handling centralized. 4. Type inference works. 5. No direct fetch in components/hooks. 6. Backward compatible.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T00:57:05.973122-05:00","updated_at":"2025-12-04T20:42:48.755305-05:00"}
{"id":"meal-28","title":"Meal Planning Evolution Epic","description":"Evolve Mise from inventory-only to complete meal planning + grocery workflow system. Core problem: Running out of food mid-week due to poor planning. Solution: Plan ‚Üí Shop ‚Üí Cook workflow.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-04T20:40:37.340259-05:00","updated_at":"2025-12-05T01:12:41.525347-05:00","closed_at":"2025-12-05T01:12:41.525347-05:00"}
{"id":"meal-29","title":"Phase 1: Database Schema for Meal Planning","description":"Add 5 new tables: saved_recipes, meal_plans, planned_meals, grocery_lists, grocery_items. Foundation for all new features.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-04T20:40:45.920555-05:00","updated_at":"2025-12-05T01:03:57.762506-05:00","closed_at":"2025-12-05T01:03:57.762506-05:00","dependencies":[{"issue_id":"meal-29","depends_on_id":"meal-28","type":"parent-child","created_at":"2025-12-04T20:41:21.814535-05:00","created_by":"brandongalang"}]}
{"id":"meal-3","title":"CRUD Tool Functions","description":"Implement deterministic inventory tools as plain TypeScript functions (no LLM). Tools: search_inventory(filters: {query?, master_id?, category?, status[]?, expiring_within_days?, include_leftovers?}) ‚Üí Container[], add_inventory(items: {master_id, container, contents, source, expires_at}[]) ‚Üí creates containers+contents+transaction, update_inventory(container_id, updates) ‚Üí updates+transaction, deduct_inventory(master_id, qty, unit, reason) ‚Üí FIFO container selection, unit conversion via global table, status transitions (SEALED‚ÜíOPEN‚ÜíLOW‚ÜíEMPTY at 20%), delete_inventory(container_id, reason) ‚Üí soft delete (status=DELETED), merge_inventory(source_id, target_id) ‚Üí combine contents. All write operations create transaction records. Expose as typed functions for agent to call.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-28T17:10:03.468726-05:00","updated_at":"2025-12-04T20:42:48.755769-05:00","closed_at":"2025-11-28T17:20:53.532928-05:00","dependencies":[{"issue_id":"meal-3","depends_on_id":"meal-2","type":"blocks","created_at":"2025-11-28T17:11:13.481654-05:00","created_by":"brandongalang"}]}
{"id":"meal-30","title":"Recipe Library Feature","description":"Save, browse, favorite, and cook from saved recipes. Components: RecipeLibrary, RecipeCard, RecipeDetail, SaveRecipeButton. API: CRUD endpoints for /api/v1/recipes.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-04T20:40:48.674257-05:00","updated_at":"2025-12-05T01:06:45.384973-05:00","closed_at":"2025-12-05T01:06:45.384973-05:00","dependencies":[{"issue_id":"meal-30","depends_on_id":"meal-29","type":"blocks","created_at":"2025-12-04T20:41:13.415472-05:00","created_by":"brandongalang"},{"issue_id":"meal-30","depends_on_id":"meal-28","type":"parent-child","created_at":"2025-12-04T20:41:21.825407-05:00","created_by":"brandongalang"}]}
{"id":"meal-31","title":"Cook Mode UI","description":"Step-by-step cooking view with large text, ingredient checklist with stock status, swipeable steps, done cooking flow with ingredient deduction and leftover logging.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-04T20:40:51.874547-05:00","updated_at":"2025-12-05T01:12:41.505686-05:00","closed_at":"2025-12-05T01:12:41.505686-05:00","dependencies":[{"issue_id":"meal-31","depends_on_id":"meal-30","type":"blocks","created_at":"2025-12-04T20:41:13.425605-05:00","created_by":"brandongalang"},{"issue_id":"meal-31","depends_on_id":"meal-28","type":"parent-child","created_at":"2025-12-04T20:41:21.833264-05:00","created_by":"brandongalang"}]}
{"id":"meal-32","title":"Meal Planning Feature","description":"Weekly view with B/L/D slots. Add recipes from library or generate new. Mark meals as cooked. Components: WeeklyPlanView, MealSlot, AddMealSheet, PlanSummary.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-04T20:40:54.32546-05:00","updated_at":"2025-12-05T01:06:45.394259-05:00","closed_at":"2025-12-05T01:06:45.394259-05:00","dependencies":[{"issue_id":"meal-32","depends_on_id":"meal-29","type":"blocks","created_at":"2025-12-04T20:41:13.43437-05:00","created_by":"brandongalang"},{"issue_id":"meal-32","depends_on_id":"meal-28","type":"parent-child","created_at":"2025-12-04T20:41:21.840798-05:00","created_by":"brandongalang"}]}
{"id":"meal-33","title":"Smart Grocery List Feature","description":"Auto-generate shopping list from meal plan minus current inventory. Check off items while shopping. Complete shopping to bulk-add to inventory. Organized by store section.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-04T20:40:57.040871-05:00","updated_at":"2025-12-05T01:06:45.409529-05:00","closed_at":"2025-12-05T01:06:45.409529-05:00","dependencies":[{"issue_id":"meal-33","depends_on_id":"meal-32","type":"blocks","created_at":"2025-12-04T20:41:13.443294-05:00","created_by":"brandongalang"},{"issue_id":"meal-33","depends_on_id":"meal-28","type":"parent-child","created_at":"2025-12-04T20:41:21.847773-05:00","created_by":"brandongalang"}]}
{"id":"meal-34","title":"AI Meal Planning Tools","description":"New agent tools: saveRecipe (save generated recipe), planWeek (AI-powered weekly suggestions), generateGroceryList. Use favorites and expiring items for smarter suggestions.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-04T20:40:59.842931-05:00","updated_at":"2025-12-05T01:12:41.513031-05:00","closed_at":"2025-12-05T01:12:41.513031-05:00","dependencies":[{"issue_id":"meal-34","depends_on_id":"meal-30","type":"blocks","created_at":"2025-12-04T20:41:13.45169-05:00","created_by":"brandongalang"},{"issue_id":"meal-34","depends_on_id":"meal-32","type":"blocks","created_at":"2025-12-04T20:41:13.459919-05:00","created_by":"brandongalang"},{"issue_id":"meal-34","depends_on_id":"meal-28","type":"parent-child","created_at":"2025-12-04T20:41:21.857997-05:00","created_by":"brandongalang"}]}
{"id":"meal-35","title":"Updated Navigation Tabs","description":"Update tab bar: Kitchen (Dashboard), Plan (Meal Plan), Recipes (Library), Shop (Grocery List), Chat (Assistant). Or 4-tab variant merging Shop into Plan.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-04T20:41:00.125295-05:00","updated_at":"2025-12-05T01:12:41.519519-05:00","closed_at":"2025-12-05T01:12:41.519519-05:00","dependencies":[{"issue_id":"meal-35","depends_on_id":"meal-28","type":"parent-child","created_at":"2025-12-04T20:41:21.866619-05:00","created_by":"brandongalang"}]}
{"id":"meal-4","title":"ParseImage Ax Signature","description":"Implement parse_image as an Ax DSPy-style signature using Gemini 2.5 Pro vision. Signature contract: Inputs: {image: Base64String, source_hint?: 'receipt'|'fridge'|'groceries'} Outputs: {source_type: 'receipt'|'photo'|'mixed', items: VisionItem[], notes?: string} where VisionItem = {name: string (canonical, lowercase, singular), quantity: number, unit: string, confidence: 'high'|'medium'|'low', needs_review: boolean, raw_text: string, category_hint: 'produce'|'protein'|'dairy'|'pantry'|'frozen'|'beverage'|'unknown'}. This signature is independently optimizable. Agent calls this tool when image attached, receives structured JSON, then uses CRUD tools to persist.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-28T17:10:13.688989-05:00","updated_at":"2025-12-04T20:42:48.756782-05:00","closed_at":"2025-11-28T17:21:57.944419-05:00","dependencies":[{"issue_id":"meal-4","depends_on_id":"meal-1","type":"blocks","created_at":"2025-11-28T17:11:13.488878-05:00","created_by":"brandongalang"}]}
{"id":"meal-5","title":"GenerateRecipe Ax Signature","description":"Implement generate_recipe as an Ax DSPy-style signature using Gemini 2.5 Pro. Signature contract: Inputs: {available_inventory: InventoryItem[], expiring_soon: InventoryItem[], constraints: {max_time_mins?, servings?, dietary?: string[]}} Outputs: {title: string, ingredients: RecipeIngredient[], steps: string[], time_estimate_mins: number, uses_expiring: string[]} where RecipeIngredient = {name, quantity, unit, in_stock: boolean}. Future inputs (V2): recent_meals, user_preferences, feedback_history, equipment list. This signature is independently optimizable. Agent gathers context via CRUD tools, calls this signature, then presents recipe to user.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-28T17:10:20.842454-05:00","updated_at":"2025-12-04T20:42:48.75694-05:00","closed_at":"2025-11-28T17:21:57.952015-05:00","dependencies":[{"issue_id":"meal-5","depends_on_id":"meal-1","type":"blocks","created_at":"2025-11-28T17:11:13.50076-05:00","created_by":"brandongalang"}]}
{"id":"meal-6","title":"Ax ReAct Agent Loop","description":"Implement the core Ax ReAct agent that orchestrates all interactions. Agent has access to tools: parse_image (Ax Signature), generate_recipe (Ax Signature), search_inventory, add_inventory, update_inventory, deduct_inventory, delete_inventory, merge_inventory (all CRUD functions). Agent responsibilities: 1) Receive user message + optional image, 2) Reason about intent (add_inventory, query, generate_recipe, cook, add_leftover, correct, delete), 3) Call appropriate tools in sequence, 4) Handle multi-turn (e.g., parse‚Üícheck dupes‚Üíadd‚Üíconfirm), 5) Generate conversational response. Agent infers: new ingredient attributes, leftover units/expiry, duplicate resolution, ambiguous matches. System prompt defines personality and capabilities.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-28T17:10:29.37995-05:00","updated_at":"2025-12-04T20:42:48.757083-05:00","closed_at":"2025-11-28T17:23:10.221133-05:00","dependencies":[{"issue_id":"meal-6","depends_on_id":"meal-3","type":"blocks","created_at":"2025-11-28T17:11:13.510102-05:00","created_by":"brandongalang"},{"issue_id":"meal-6","depends_on_id":"meal-4","type":"blocks","created_at":"2025-11-28T17:11:13.51625-05:00","created_by":"brandongalang"}]}
{"id":"meal-7","title":"Chat API Route with SSE","description":"Implement POST /api/v1/chat endpoint that bridges Vercel AI SDK with Ax agent. Request: {message: string|null, attachments?: [{type: 'image', data: base64, mime_type: string}]}. Response: SSE stream. Flow: 1) Parse request, extract image if present, 2) Call Ax agent with message+image, 3) Stream agent responses as SSE events: 'thinking' (status updates), 'message' (content chunks), 'error' (failures), 4) Agent tool calls happen server-side, results streamed. Use Vercel AI SDK's streaming utilities for SSE formatting. Handle timeouts (30s for vision, 15s for text).","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-11-28T17:10:37.152847-05:00","updated_at":"2025-12-04T20:42:48.757241-05:00","closed_at":"2025-11-28T17:23:55.07705-05:00","dependencies":[{"issue_id":"meal-7","depends_on_id":"meal-6","type":"blocks","created_at":"2025-11-28T17:11:13.523225-05:00","created_by":"brandongalang"}]}
{"id":"meal-8","title":"Dashboard API Route","description":"Implement GET /api/v1/inventory/summary for dashboard data. Response: {expiring_soon: Item[] (within 3 days), categories: {produce: {count, items}, protein: {...}, dairy: {...}, pantry: {...}, frozen: {...}, beverage: {...}}, leftovers: Item[] (dish_name not null), total_count: number}. Each Item includes: container_id, name, remaining_qty, unit, status, expires_at, days_until_expiry. Pure read-only aggregation query, no agent involvement. Used by dashboard for glanceable state.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-28T17:10:44.022449-05:00","updated_at":"2025-12-04T20:42:48.757397-05:00","closed_at":"2025-11-28T17:23:55.087683-05:00","dependencies":[{"issue_id":"meal-8","depends_on_id":"meal-3","type":"blocks","created_at":"2025-11-28T17:11:13.530455-05:00","created_by":"brandongalang"}]}
{"id":"meal-9","title":"Chat UI Component","description":"Build chat interface using Vercel AI SDK useChat hook + ShadCN components. Features: 1) Message list with user/assistant bubbles, 2) Text input with send button, 3) Image attachment button (camera/gallery picker), 4) Image preview thumbnail in user messages, 5) 'Analyzing...' loading state while agent processes, 6) Plain text rendering of agent responses (no generative UI), 7) Auto-scroll to latest message, 8) Mobile-responsive. useChat connects to /api/v1/chat endpoint. Handle SSE events: thinking‚Üíshow status, message‚Üíappend content, error‚Üíshow error state.","design":"Build chat interface as the primary interaction surface. Mobile-first, chat-centric design.\n\n## Tech Stack\n- Custom components (not shadcn) for full aesthetic control\n- Framer Motion for animations\n- SSE via fetch + ReadableStream (not Vercel AI SDK useChat)\n\n## Design System (\"Vibrant Organic\")\n- Fonts: Fraunces (display), DM Sans (body)\n- Colors: Cream base (#FDF6E3), herb green (#2D5016), tomato red (#E63946), citrus orange (#FF8C42)\n- Install: npm install framer-motion @fontsource/fraunces @fontsource/dm-sans\n\n## Components to Create\n\n### ChatContainer (src/components/chat/ChatContainer.tsx)\n- Main wrapper managing message state and SSE connection\n- State: messages[], isThinking, thinkingText\n- Auto-scroll to bottom on new message\n- Handles SSE events: thinking, message, actions, complete, error\n\n### MessageBubble (src/components/chat/MessageBubble.tsx)\n- User: right-aligned, bg-herb, text-white, rounded-lg rounded-br-sm\n- Assistant: left-aligned, bg-cream-dark, border clay-light, rounded-lg rounded-bl-sm\n- Max width 85%, padding 12px 16px\n- Image attachments show as 64x64 thumbnails\n\n### ChatInput (src/components/chat/ChatInput.tsx)\n- Layout: [camera btn] [textarea] [send btn]\n- Sticky bottom with safe-area-inset-bottom padding\n- Auto-resize textarea up to 4 lines\n- Enter to send, Shift+Enter for newline\n- Camera opens native picker, shows thumbnail preview before send\n\n### ThinkingIndicator (src/components/chat/ThinkingIndicator.tsx)\n- Three bouncing dots with staggered Framer Motion animation\n- Shows text: \"Thinking...\" or \"Analyzing your image...\"\n\n### QuickActionChips (src/components/chat/QuickActionChips.tsx)\n- Floating above input when keyboard closed\n- Chips: [Scan] [Recipe] [Inventory]\n- Horizontal scroll, bg-white border-clay rounded-full\n\n## Hook: useChat (src/hooks/useChat.ts)\nSSE parsing via fetch ReadableStream, NOT EventSource (need POST).\nReturns: messages[], isThinking, thinkingText, sendMessage(), clearHistory()\n\n## Files to Modify\n- src/app/page.tsx - Replace placeholder with ChatContainer\n- src/app/globals.css - Add design system CSS variables\n- src/app/layout.tsx - Add font imports","acceptance_criteria":"- [ ] ChatContainer renders and manages message state\n- [ ] MessageBubble shows user messages (right, green) and assistant (left, cream)\n- [ ] ChatInput has textarea + camera button + send button\n- [ ] Send button posts message via useChat hook\n- [ ] ThinkingIndicator shows animated dots when isThinking=true\n- [ ] QuickActionChips render above input (Scan, Recipe, Inventory)\n- [ ] Auto-scroll to bottom on new message\n- [ ] Mobile responsive (works on 375px width)\n- [ ] Design system colors/fonts applied correctly\n- [ ] src/app/page.tsx renders ChatContainer","notes":"SUPERSEDES ORIGINAL DESCRIPTION - Use Design notes instead.\n\nOriginal description mentioned Vercel AI SDK + ShadCN - this has been updated.\nCorrect approach: Custom components + fetch/ReadableStream for SSE.\nSee Design field for full implementation spec.","status":"in_progress","priority":0,"issue_type":"feature","created_at":"2025-11-28T17:10:50.897119-05:00","updated_at":"2025-12-04T20:42:48.757562-05:00","closed_at":"2025-11-28T18:05:55.614727-05:00","dependencies":[{"issue_id":"meal-9","depends_on_id":"meal-7","type":"blocks","created_at":"2025-11-28T17:11:13.537043-05:00","created_by":"brandongalang"},{"issue_id":"meal-9","depends_on_id":"meal-12","type":"blocks","created_at":"2025-11-28T17:53:28.396991-05:00","created_by":"brandongalang"},{"issue_id":"meal-9","depends_on_id":"meal-14","type":"blocks","created_at":"2025-11-28T17:53:28.404466-05:00","created_by":"brandongalang"}]}
